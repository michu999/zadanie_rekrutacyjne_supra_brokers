{% extends 'contacts/base.html' %}
{% load static %}

{% block title %}{{ contact }} - Szczegóły kontaktu{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'contacts:list' %}">
                        <i class="bi bi-house me-1"></i>Kontakty
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ contact }}
                </li>
            </ol>
        </nav>

        <!-- Contact Details Card -->
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="bi bi-person-circle me-2"></i>
                    {{ contact.first_name }} {{ contact.last_name }}
                </h4>
                <span class="badge
                    {% if contact.status.name == 'nowy' %}bg-success
                    {% elif contact.status.name == 'w trakcie' %}bg-light text-primary
                    {% elif contact.status.name == 'zagubiony' %}bg-warning text-dark
                    {% elif contact.status.name == 'nieaktualny' %}bg-secondary
                    {% else %}bg-info{% endif %} fs-6">
                    {{ contact.status.name }}
                </span>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Contact Information -->
                    <div class="col-md-6">
                        <h5 class="text-muted mb-3">
                            <i class="bi bi-person-lines-fill me-2"></i>Dane kontaktowe
                        </h5>
                        <dl class="row mb-0">
                            <dt class="col-sm-4">Imię:</dt>
                            <dd class="col-sm-8">{{ contact.first_name }}</dd>

                            <dt class="col-sm-4">Nazwisko:</dt>
                            <dd class="col-sm-8">{{ contact.last_name }}</dd>

                            <dt class="col-sm-4">Telefon:</dt>
                            <dd class="col-sm-8">
                                <a href="tel:{{ contact.phone_number }}" class="text-decoration-none">
                                    <i class="bi bi-telephone me-1"></i>{{ contact.phone_number }}
                                </a>
                            </dd>

                            <dt class="col-sm-4">E-mail:</dt>
                            <dd class="col-sm-8">
                                <a href="mailto:{{ contact.email }}" class="text-decoration-none">
                                    <i class="bi bi-envelope me-1"></i>{{ contact.email }}
                                </a>
                            </dd>

                            <dt class="col-sm-4">Miasto:</dt>
                            <dd class="col-sm-8">
                                <i class="bi bi-geo-alt me-1"></i>{{ contact.city }}
                            </dd>

                            <dt class="col-sm-4">Dodano:</dt>
                            <dd class="col-sm-8">
                                <i class="bi bi-calendar me-1"></i>
                                {{ contact.date_added|date:"d.m.Y H:i" }}
                            </dd>
                        </dl>
                    </div>

                    <!-- Weather Information -->
                    <div class="col-md-6">
                        <h5 class="text-muted mb-3">
                            <i class="bi bi-cloud-sun me-2"></i>Pogoda w {{ contact.city }}
                        </h5>
                        <div class="weather-detail-card" data-city="{{ contact.city }}">
                            <div class="weather-loading text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Ładowanie...</span>
                                </div>
                                <p class="text-muted mt-2">Pobieranie danych pogodowych...</p>
                            </div>
                            <div class="weather-content d-none">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <div class="weather-icon mb-2">
                                                    <i class="bi bi-thermometer-half display-6 text-danger"></i>
                                                </div>
                                                <div class="weather-value fs-4 fw-bold temperature">--</div>
                                                <div class="weather-label text-muted small">Temperatura</div>
                                            </div>
                                            <div class="col-4">
                                                <div class="weather-icon mb-2">
                                                    <i class="bi bi-droplet-half display-6 text-primary"></i>
                                                </div>
                                                <div class="weather-value fs-4 fw-bold humidity">--</div>
                                                <div class="weather-label text-muted small">Wilgotność</div>
                                            </div>
                                            <div class="col-4">
                                                <div class="weather-icon mb-2">
                                                    <i class="bi bi-wind display-6 text-info"></i>
                                                </div>
                                                <div class="weather-value fs-4 fw-bold wind-speed">--</div>
                                                <div class="weather-label text-muted small">Wiatr</div>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="text-center">
                                            <span class="weather-description text-muted"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="weather-error d-none">
                                <div class="alert alert-warning mb-0">
                                    <i class="bi bi-cloud-slash me-2"></i>
                                    Nie udało się pobrać danych pogodowych dla tego miasta.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Footer with Actions -->
            <div class="card-footer bg-light d-flex justify-content-between">
                <a href="{% url 'contacts:list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>Powrót do listy
                </a>
                <div class="btn-group">
                    <a href="{% url 'contacts:update' contact.pk %}" class="btn btn-primary">
                        <i class="bi bi-pencil me-1"></i>Edytuj
                    </a>
                    <a href="{% url 'contacts:delete' contact.pk %}" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>Usuń
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'contacts/js/weather.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadWeatherForDetailPage();
    });
</script>
{% endblock %}
